var app = angular.module("MoneyManagerApp", []);
app.controller("HomePageController", ["$scope", "$element", "$http",
    function ($scope, $element, $http) {
        $scope.allStocks = {};
        $scope.TotalAmountInvested = '';
        $scope.CurrentValueOfInvestments = '';
        $scope.OverallChange=''


        $scope.init = function () {
            $scope.GetAllStocks();
            $scope.GetAllMUtualFunds();
        }

        $scope.GetAllStocks = function () {
            $http.get("http://localhost:3772/api/HomePage").then(function (homePageResponse) {
                var response = homePageResponse;
                $scope.currentStockValue = homePageResponse.data.currentValueStocks;
                $scope.totalInvestmentValue = homePageResponse.data.amountInStocks;
                $scope.changeInValue = homePageResponse.data.changeStocks;
                $scope.profitLossStocks = homePageResponse.data.profitLossStocks;
            });
        };

        $scope.GetAllMUtualFunds = function () {
            $http.get("http://localhost:3772/api/HomePage/GetMutualFunds").then(function (homePageResponse) {
                var response = homePageResponse;
                $scope.currentFundsValue = homePageResponse.data.currentValueFunds;
                $scope.totalInvestmentValueFunds = homePageResponse.data.amountInFunds;
                $scope.changeInValueFunds = homePageResponse.data.changeFunds;
                $scope.profitLossFunds = homePageResponse.data.profitLossFunds;
            });
        };
    }]);
app.controller("MutualFundController", ["$scope", "$element", "$http",
    function ($scope, $element, $http) {
        $scope.allMutualfunds = {};
        $scope.newMutualFund = {};

        $scope.init = function () {
            $scope.GetAllMutualFunds();
        }

        $scope.MutualFundAdd = function () {
            $scope.newMutualFunds.mfName = '';
            $scope.newMutualFunds.mfavgNAV = '';
            $scope.newMutualFunds.mfCurrentNAV = '';
            $scope.newMutualFunds.mfQuantity = '';
            $('#MutualFundAddPopup').modal('toggle');
        }

        $scope.GetAllMutualFunds = function () {
            $http.get("http://localhost:3772/api/MutualFunds").then(function (AllMFsResponse) {
                $scope.allMutualfunds = AllMFsResponse.data;
            });
        };

        $scope.AddMutualFunds = function () {
            var data = {
                MutualFundName: $scope.newMutualFunds.mfName,
                InvestmentNAV: $scope.newMutualFunds.mfavgNAV,
                CurrentNAV: $scope.newMutualFunds.mfCurrentNAV,
                UnitsHeld: $scope.newMutualFunds.mfQuantity,
            };
            $http.post("http://localhost:3772/api/MutualFunds", data).then(function (addResponse) {
                var response = addResponse;
                $('#MutualFundAddPopup').modal('toggle');
                $scope.GetAllMutualFunds();
            });
        };

        $scope.Cancel = function () {
            $('#MutualFundAddPopup').modal('toggle');
        }




    }]);
app.controller("OptionsController", ["$scope", "$element", "$http",
    function ($scope, $element, $http) {
        $scope.AllOptions = {};
        $scope.newoption = {};


        $scope.init = function () {
            $scope.GetAllOptions();
        }

        $scope.ShowOptionAddPopup = function () {
            $scope.newoption.optionName = '';
            $scope.newoption.avgPrice = '';
            $scope.newoption.change = '';
            $scope.newoption.currentInvestmentValue = '';
            $scope.newoption.currentoptionPrice = '';
            $scope.newoption.quantity = '';
            $scope.newoption.totalInvestmentValue = '';
            $('#optionAddPopup').modal('toggle');
        };

        $scope.GetAllOptions = function () {
            $http.get("http://localhost:3772/api/api/OptionsPage").then(function (allOptionsResponse) {
                $scope.AllOptions = allOptionsResponse.data;
            });
        }

        $scope.AddOption = function () {
            var data = {
                optionName: $scope.newoption.optionName,
                avgPrice: $scope.newoption.avgPrice,
                currentOptionPrice: $scope.newoption.currentoptionPrice,
                quantity: $scope.newoption.quantity
            };
            $http.post("http://localhost:3772/api/api/OptionsPage",data).then(function (allOptionsResponse) {
                $scope.AllOptions = allOptionsResponse.data;
            });
        }

        $scope.SellOption = function () {
            var data = {
                optionName: $scope.editoption.optionName,
                avgPrice: $scope.editoption.avgPrice,
                currentOptionPrice: $scope.editoption.currentoptionPrice,
                quantity: $scope.editoption.quantity
            };
            $http.post("http://localhost:3772/api/api/OptionsPage/SellOption", data).then(function (allOptionsResponse) {
                $scope.AllOptions = allOptionsResponse.data;
            });
        }

    }
]);
app.controller("StocksController", ["$scope", "$element", "$http",
    function ($scope, $element, $http) {
        $scope.newStock = {};
        $scope.allStocks = {};
        $scope.editStockData = {};
        $scope.sumOfStocksWithProfit = '';
        $scope.sumOfStocksWithLoss = '';
        $scope.sumOfStocksWithProfitSold = 'NA';
        $scope.sumOfStocksWithLossSold = 'NA';
        $scope.sellShare = false;

        $scope.Cancel = function () {
            $('#stockAddPopUp').modal('toggle');
        };

        $scope.init = function () {
            $scope.GetAllStocks();
            $scope.GetStocksRelatedData();
        }

        $scope.ShowStockAddPopUp = function () {
            $scope.newStock.stockName = '';
            $scope.newStock.avgPrice = '';
            $scope.newStock.change = '';
            $scope.newStock.currentInvestmentValue = '';
            $scope.newStock.currentSharePrice = '';
            $scope.newStock.date = '';
            $scope.newStock.quantity = '';
            $scope.newStock.sector = '';
            $scope.newStock.totalInvestmentValue = '';
            $scope.sellShare = false;
            $('#stockAddPopUp').modal('toggle');
        };

        $scope.UpdateStock = function (data) {
            var editStockData = data;
            $scope.editStockData = data;
            $('#stockUpdatePopUp').modal('toggle');
        };

        $scope.UpdateStockData = function () {
            var data = {
                stockName: $scope.editStockData.stockName,
                avgPrice: $scope.editStockData.avgPrice,
                currentSharePrice: $scope.editStockData.currentSharePrice,
                date: $scope.editStockData.date,
                quantity: $scope.editStockData.quantity,
                sector: $scope.editStockData.sector
            };
            $http.put("http://localhost:3772/api/AddNewStock", data).then(function (addResponse) {
                var response = addResponse;
                $scope.GetAllStocks();
            });
            $('#stockUpdatePopUp').modal('toggle');
        };

        $scope.GetStocksRelatedData = function () {
            $http.get("http://localhost:3772/api/AddNewStock/GetDetails").then(function (stockDetailsData) {
                var response = stockDetailsData.data;
                $scope.sumOfStocksWithProfit = response.totalProfitOnStocks;
                $scope.sumOfStocksWithLoss = response.totalLossOnStocks;
            });
        };


        $scope.AddStock = function () {
            var data = {
                stockName: $scope.newStock.stockName,
                avgPrice: $scope.newStock.avgPrice,
                currentSharePrice: $scope.newStock.currentSharePrice,
                quantity: $scope.newStock.quantity,
                sector: $scope.newStock.sector
            };
            $http.post("http://localhost:3772/api/AddNewStock", data).then(function (addResponse) {
                var response = addResponse;
                $('#stockAddPopUp').modal('toggle');
                $scope.GetAllStocks();
            });

        };

        $scope.loadFile = function (files) {
            $scope.selectedFile = files[0];
        }

        $scope.ProcessTransactions = function () {
            $http.post("http://localhost:3772/api/AddNewStock/ProcessImport").then(function (fileImportResponse) {
                var response = fileImportResponse.data;
                if (response !== undefined && response) {
                    $scope.success = true;
                    $scope.listOfUpdatedStocks = response;
                    $scope.init();
                }
            });
        }


        $scope.GetAllStocks = function () {
            $http.get("http://localhost:3772/api/AddNewStock").then(function (AllStocksResponse) {
                var response = AllStocksResponse;
                $scope.allStocks = AllStocksResponse.data;
            });
        };

        $scope.SellStock = function () {
            $scope.sellShare = true;
            $scope.updateSellingStatus();
        };

        $scope.updateSellingStatus = function () {
            var data = {
                stockName: $scope.editStockData.stockName,
                avgPrice: $scope.editStockData.avgPrice,
                currentSharePrice: $scope.editStockData.currentSharePrice,
                date: $scope.editStockData.date,
                quantity: $scope.editStockData.quantity,
                sector: $scope.editStockData.sector
            };
            $http.post("http://localhost:3772/api/AddNewStock/SellStock", data).then(function (sellResponse) {
            });
        }
        $scope.init();
    }]);